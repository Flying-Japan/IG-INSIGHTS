<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IG 인사이트 대시보드</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/tabulator-tables@6.3.0/dist/css/tabulator_midnight.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <h1>IG 인사이트 대시보드</h1>
    </div>
    <div class="header-right">
      <button id="manual-update-btn" class="update-btn" title="데이터를 즉시 업데이트합니다">수동 업데이트</button>
      <span class="update-time" id="update-time">loading...</span>
    </div>
  </header>

  <!-- Milestone Filter -->
  <div class="milestone-bar">
    <span class="milestone-label">운영 기점 필터</span>
    <div class="milestone-toggle" id="milestone-toggle">
      <button class="milestone-btn active" data-filter="all">전체 (Total)</button>
      <button class="milestone-btn" data-filter="before">담당 이전 (Before)</button>
      <button class="milestone-btn" data-filter="after">담당 이후 (After)</button>
    </div>
    <span class="milestone-date">기준일: 2025.12.26</span>
  </div>

  <!-- Follower Change Banner -->
  <div class="follower-banner" id="follower-banner" style="display:none"></div>
  <!-- 전일 비교 데이터 없음 안내 -->
  <div class="no-yesterday-notice" id="no-yesterday-notice" style="display:none">전일 비교 데이터가 없어 변화량(+/-) 표시가 제한됩니다</div>

  <!-- Tab Navigation -->
  <nav class="tab-nav">
    <button class="tab-btn active" data-tab="overview">개요</button>
    <button class="tab-btn" data-tab="posts">게시물</button>
    <button class="tab-btn" data-tab="followers">팔로워</button>
    <button class="tab-btn" data-tab="category">카테고리 분석</button>
    <button class="tab-btn" data-tab="content">콘텐츠 분석</button>
  </nav>

  <!-- Loading -->
  <div id="loading" class="loading">
    <div class="spinner"></div>
    <p>데이터 로딩 중...</p>
  </div>

  <!-- Tab Contents -->
  <main class="container">

    <!-- 1. Overview Tab -->
    <section id="tab-overview" class="tab-content active">
      <div class="kpi-stats-section">
        <div class="kpi-stats-header">
          <select class="kpi-mode-dropdown" id="kpi-mode-dropdown">
            <option value="total">합계</option>
            <option value="avg">평균</option>
            <option value="yearly">년도별</option>
            <option value="monthly">월별</option>
            <option value="weekly">주별</option>
            <option value="daily">일별</option>
          </select>
          <div class="kpi-period-selectors" id="kpi-period-selectors"></div>
          <button class="col-toggle-btn" id="stats-toggle-btn" title="표시할 항목 선택">⚙ 항목</button>
        </div>
        <div class="col-toggle-panel" id="stats-toggle-panel" style="display:none">
          <div class="col-toggle-list" id="stats-toggle-list"></div>
        </div>
        <div class="kpi-grid kpi-stats-grid" id="kpi-stats-grid">
          <div class="kpi-card" data-stat="posts">
            <div class="kpi-label" id="kpi-stat-posts-label">총 게시물</div>
            <div class="kpi-value" id="kpi-total-posts">-</div>
          </div>
          <div class="kpi-card" data-stat="followers">
            <div class="kpi-label" id="kpi-stat-followers-label">현재 팔로워</div>
            <div class="kpi-value" id="kpi-total-followers">-</div>
            <div class="kpi-sub" id="kpi-followers-change"></div>
          </div>
          <div class="kpi-card" data-stat="reach">
            <div class="kpi-label" id="kpi-stat-reach-label">전체 도달</div>
            <div class="kpi-value" id="kpi-total-reach">-</div>
          </div>
          <div class="kpi-card" data-stat="views">
            <div class="kpi-label" id="kpi-stat-views-label">전체 조회수</div>
            <div class="kpi-value" id="kpi-total-views">-</div>
          </div>
          <div class="kpi-card" data-stat="likes">
            <div class="kpi-label" id="kpi-stat-likes-label">전체 좋아요</div>
            <div class="kpi-value" id="kpi-total-likes">-</div>
          </div>
          <div class="kpi-card" data-stat="saves">
            <div class="kpi-label" id="kpi-stat-saves-label">전체 저장</div>
            <div class="kpi-value" id="kpi-total-saves">-</div>
          </div>
          <div class="kpi-card" data-stat="shares">
            <div class="kpi-label" id="kpi-stat-shares-label">전체 공유</div>
            <div class="kpi-value" id="kpi-total-shares">-</div>
          </div>
          <div class="kpi-card" data-stat="comments">
            <div class="kpi-label" id="kpi-stat-comments-label">전체 댓글</div>
            <div class="kpi-value" id="kpi-total-comments">-</div>
          </div>
          <div class="kpi-card" data-stat="engagement">
            <div class="kpi-label" id="kpi-stat-engagement-label">전체 참여</div>
            <div class="kpi-value" id="kpi-total-engagement">-</div>
          </div>
          <div class="kpi-card" data-stat="engagement_rate">
            <div class="kpi-label" id="kpi-stat-engagement_rate-label">평균 참여율</div>
            <div class="kpi-value" id="kpi-total-engagement_rate">-</div>
          </div>
          <div class="kpi-card" data-stat="save_rate">
            <div class="kpi-label" id="kpi-stat-save_rate-label">평균 저장율</div>
            <div class="kpi-value" id="kpi-total-save_rate">-</div>
          </div>
          <div class="kpi-card" data-stat="share_rate">
            <div class="kpi-label" id="kpi-stat-share_rate-label">평균 공유율</div>
            <div class="kpi-value" id="kpi-total-share_rate">-</div>
          </div>
          <div class="kpi-card" data-stat="follows">
            <div class="kpi-label" id="kpi-stat-follows-label">팔로우 유입</div>
            <div class="kpi-value" id="kpi-total-follows">-</div>
          </div>
          <div class="kpi-card" data-stat="top_post">
            <div class="kpi-label" id="kpi-stat-top_post-label">TOP 게시물</div>
            <div class="kpi-value kpi-value-sm" id="kpi-total-top_post">-</div>
          </div>
        </div>
      </div>
      <div class="chart-grid">
        <div class="chart-box">
          <h3>팔로워 추이</h3>
          <div id="chart-follower-trend"></div>
        </div>
        <div class="chart-box">
          <h3>콘텐츠 유형 분포</h3>
          <div id="chart-type-dist"></div>
        </div>
        <div class="chart-box full-width">
          <div class="chart-header">
            <h3>요일별 도달 & 참여</h3>
            <div class="dow-controls">
              <div class="toggle-group" id="dow-toggle">
                <button class="toggle-btn active" data-mode="all">전체</button>
                <button class="toggle-btn" data-mode="month">월별</button>
                <button class="toggle-btn" data-mode="week">주별</button>
                <button class="toggle-btn" data-mode="daily">일별</button>
              </div>
              <div class="dow-selectors" id="dow-selectors"></div>
            </div>
          </div>
          <div id="chart-daily-reach"></div>
        </div>
      </div>
      <!-- 마케터 분석 섹션 -->
      <div class="kpi-grid kpi-grid-4">
        <div class="kpi-card">
          <div class="kpi-label">평균 저장율 <span class="kpi-tooltip-wrap"><span class="kpi-tooltip-icon">ⓘ</span><span class="kpi-tooltip-text">(저장 / 도달) × 100. 콘텐츠를 저장할 만큼 가치를 느낀 비율<div class="kpi-benchmark-scale"><div class="benchmark-title">여행 업종 기준 (2025)</div><div class="benchmark-bar"><div class="benchmark-seg low" style="width:25%"><span class="seg-label">미흡</span></div><div class="benchmark-seg normal" style="width:25%"><span class="seg-label">보통</span></div><div class="benchmark-seg good" style="width:25%"><span class="seg-label">양호</span></div><div class="benchmark-seg excellent" style="width:25%"><span class="seg-label">우수</span></div></div><div class="benchmark-labels"><span class="benchmark-val" style="width:25%">0%</span><span class="benchmark-val" style="width:25%">0.3%</span><span class="benchmark-val" style="width:25%">1%</span><span class="benchmark-val" style="width:25%">3%</span></div><div class="benchmark-note">캐러셀 평균 저장율 약 3.4%. 여행 콘텐츠는 저장율이 높은 편 (정보성 콘텐츠 +24%)</div></div></span></span></div>
          <div class="kpi-value" id="kpi-avg-save-rate">-</div>
          <div class="kpi-sub" style="color:var(--text2)">저장 / 도달</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">평균 공유율 <span class="kpi-tooltip-wrap"><span class="kpi-tooltip-icon">ⓘ</span><span class="kpi-tooltip-text">(공유 / 도달) × 100. 다른 사람에게 공유할 만큼 가치를 느낀 비율<div class="kpi-benchmark-scale"><div class="benchmark-title">여행 업종 기준 (2025)</div><div class="benchmark-bar"><div class="benchmark-seg low" style="width:25%"><span class="seg-label">미흡</span></div><div class="benchmark-seg normal" style="width:25%"><span class="seg-label">보통</span></div><div class="benchmark-seg good" style="width:25%"><span class="seg-label">양호</span></div><div class="benchmark-seg excellent" style="width:25%"><span class="seg-label">우수</span></div></div><div class="benchmark-labels"><span class="benchmark-val" style="width:25%">0%</span><span class="benchmark-val" style="width:25%">0.2%</span><span class="benchmark-val" style="width:25%">0.5%</span><span class="benchmark-val" style="width:25%">1.5%</span></div><div class="benchmark-note">2025 IG 알고리즘이 DM 공유(Sends)를 최우선 순위로 반영. 공유율이 높을수록 도달 확대</div></div></span></span></div>
          <div class="kpi-value" id="kpi-avg-share-rate">-</div>
          <div class="kpi-sub" style="color:var(--text2)">공유 / 도달</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">게시물당 평균 참여 <span class="kpi-tooltip-wrap"><span class="kpi-tooltip-icon">ⓘ</span><span class="kpi-tooltip-text">전체 참여(좋아요+저장+공유+댓글) / 게시물 수. 게시물 하나당 평균 반응 횟수<div class="kpi-benchmark-scale"><div class="benchmark-title">여행 업종 기준 (2025)</div><div class="benchmark-bar"><div class="benchmark-seg low" style="width:25%"><span class="seg-label">미흡</span></div><div class="benchmark-seg normal" style="width:25%"><span class="seg-label">보통</span></div><div class="benchmark-seg good" style="width:25%"><span class="seg-label">양호</span></div><div class="benchmark-seg excellent" style="width:25%"><span class="seg-label">우수</span></div></div><div class="benchmark-labels"><span class="benchmark-val" style="width:25%">0</span><span class="benchmark-val" style="width:25%">30</span><span class="benchmark-val" style="width:25%">100</span><span class="benchmark-val" style="width:25%">300</span></div><div class="benchmark-note">팔로워 1만 이하 계정 기준. 팔로워 규모가 클수록 절대 수치는 높지만 비율은 낮아지는 경향</div></div></span></span></div>
          <div class="kpi-value" id="kpi-avg-engagement-per-post">-</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">팔로워 대비 도달율 <span class="kpi-tooltip-wrap"><span class="kpi-tooltip-icon">ⓘ</span><span class="kpi-tooltip-text">평균 도달 / 현재 팔로워 × 100. 100%를 넘으면 비팔로워(탐색탭, 해시태그, 공유 등)에게도 많이 노출되고 있다는 의미<div class="kpi-benchmark-scale"><div class="benchmark-title">여행 업종 기준 (2025)</div><div class="benchmark-bar"><div class="benchmark-seg low" style="width:25%"><span class="seg-label">미흡</span></div><div class="benchmark-seg normal" style="width:25%"><span class="seg-label">보통</span></div><div class="benchmark-seg good" style="width:25%"><span class="seg-label">양호</span></div><div class="benchmark-seg excellent" style="width:25%"><span class="seg-label">우수</span></div></div><div class="benchmark-labels"><span class="benchmark-val" style="width:25%">0%</span><span class="benchmark-val" style="width:25%">20%</span><span class="benchmark-val" style="width:25%">50%</span><span class="benchmark-val" style="width:25%">150%</span></div><div class="benchmark-note">2025 IG 평균 도달율 약 20~30%. 50% 이상이면 양호, 100% 초과 시 비팔로워 유입 활발</div></div></span></span></div>
          <div class="kpi-value" id="kpi-reach-rate">-</div>
          <div class="kpi-sub" style="color:var(--text2)">평균 도달 / 팔로워</div>
        </div>
      </div>
      <!-- 기여도 분석 섹션 -->
      <div class="contribution-section">
        <div class="section-header">
          <h3>운영 기여도 분석</h3>
          <span class="section-sub">전체 누적 데이터 중 담당 이후(2025.12.26~) 기간의 기여 비중</span>
        </div>
        <div class="contribution-grid" id="contribution-grid"></div>
      </div>
      <div class="chart-grid">
        <div class="chart-box">
          <h3>캐러셀 vs 릴스 비교</h3>
          <div id="chart-type-compare"></div>
        </div>
      </div>
    </section>

    <!-- 2. Posts Tab -->
    <section id="tab-posts" class="tab-content">
      <div class="sort-bar">
        <label class="sort-label">정렬 기준</label>
        <select id="sort-select" class="sort-dropdown">
          <option value="rank|asc">종합순위</option>
          <option value="upload_date|desc">최신순</option>
          <option value="views|desc">조회수순</option>
          <option value="reach|desc">도달순</option>
          <option value="likes|desc">좋아요순</option>
          <option value="saves|desc">저장순</option>
          <option value="shares|desc">공유순</option>
          <option value="comments|desc">댓글순</option>
          <option value="follows|desc">팔로우순</option>
          <option value="follow_rate|desc">팔로우 전환율순</option>
          <option value="engagement_rate|desc">참여율순</option>
        </select>
      </div>
      <div class="filter-bar">
        <select id="filter-category">
          <option value="">전체 카테고리</option>
        </select>
        <select id="filter-type">
          <option value="">전체 유형</option>
          <option value="CAROUSEL_ALBUM">캐러셀</option>
          <option value="VIDEO">릴스/영상</option>
          <option value="IMAGE">이미지</option>
        </select>
        <input type="text" id="filter-search" placeholder="제목·카테고리·유형 검색...">
        <button class="compact-toggle-btn" id="compact-toggle-btn" title="현재: 전체 숫자 → 클릭하면 K/M 축약">숫자</button>
        <button class="col-toggle-btn" id="col-toggle-btn" title="표시할 칼럼 선택">⚙ 칼럼</button>
      </div>
      <div class="col-toggle-panel" id="col-toggle-panel" style="display:none">
        <div class="col-toggle-list" id="col-toggle-list"></div>
      </div>
      <div id="post-table"></div>
    </section>

    <!-- 3. Followers Tab -->
    <section id="tab-followers" class="tab-content">
      <div class="kpi-grid kpi-grid-4">
        <div class="kpi-card">
          <div class="kpi-label">총 성장</div>
          <div class="kpi-value" id="kpi-total-growth">-</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">일평균 성장</div>
          <div class="kpi-value" id="kpi-avg-growth">-</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">최고 성장일</div>
          <div class="kpi-value kpi-value-sm" id="kpi-best-day">-</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">현재 팔로워</div>
          <div class="kpi-value" id="kpi-current-followers">-</div>
        </div>
      </div>
      <div class="chart-box">
        <div class="chart-header">
          <h3>팔로워 추이 (전체)</h3>
          <div class="follower-month-controls">
            <select id="follower-year-select" class="follower-period-select"></select>
            <select id="follower-month-select" class="follower-period-select"></select>
          </div>
        </div>
        <div id="follower-data-notice" class="no-yesterday-notice" style="display:none"></div>
        <div id="chart-follower-full"></div>
      </div>
      <div class="chart-box">
        <h3>일별 팔로워 변화</h3>
        <div id="chart-follower-change"></div>
      </div>
    </section>

    <!-- 4. Category Tab -->
    <section id="tab-category" class="tab-content">
      <div class="insight-box" id="category-insights"></div>
      <div class="chart-grid">
        <div class="chart-box">
          <h3>카테고리별 평균 참여율</h3>
          <div id="chart-cat-engagement"></div>
        </div>
        <div class="chart-box">
          <h3>카테고리별 평균 도달</h3>
          <div id="chart-cat-reach"></div>
        </div>
      </div>
      <div class="chart-box">
        <h3>카테고리별 평균 저장/공유</h3>
        <div id="chart-cat-save-share"></div>
      </div>
      <div class="table-box">
        <h3>카테고리 요약</h3>
        <div id="cat-summary-table"></div>
      </div>
    </section>

    <!-- 5. Content Analysis Tab -->
    <section id="tab-content" class="tab-content">
      <!-- Performance Summary -->
      <div class="summary-section">
        <div class="summary-header">
          <h3>성과 분석 요약</h3>
          <div class="summary-controls">
            <select class="kpi-mode-dropdown" id="summary-period-select">
              <option value="all">전체 평균</option>
              <option value="yearly">년도별</option>
              <option value="monthly">월별</option>
              <option value="weekly">주별</option>
              <option value="daily">일별</option>
            </select>
            <div id="summary-period-selectors" class="kpi-period-selectors"></div>
            <button class="update-btn" id="export-report-btn" title="엑셀 보고서 다운로드">📊 보고서 다운로드</button>
          </div>
        </div>
        <div id="summary-content"></div>
      </div>
      <div class="insight-box" id="content-insights"></div>
      <div id="metric-champions" class="metric-champions"></div>
      <div class="chart-grid">
        <div class="chart-box">
          <h3>콘텐츠 유형별 성과 비교</h3>
          <div id="chart-content-compare"></div>
        </div>
        <div class="chart-box">
          <h3>도달 vs 참여율</h3>
          <div id="chart-scatter"></div>
        </div>
      </div>
      <div class="table-box">
        <h3>TOP 10 게시물</h3>
        <div id="top10-table"></div>
      </div>
    </section>

  </main>

  <!-- Post Diagnosis Modal -->
  <div id="post-modal" class="modal-overlay" style="display:none">
    <div class="modal-content">
      <button class="modal-close" id="modal-close">&times;</button>
      <h2 class="modal-title" id="modal-title">게시물 진단</h2>
      <div class="modal-meta" id="modal-meta"></div>
      <div class="modal-stats" id="modal-stats"></div>
      <div class="modal-diagnosis" id="modal-diagnosis"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="https://unpkg.com/tabulator-tables@6.3.0/dist/js/tabulator.min.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
